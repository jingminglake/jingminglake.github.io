---
layout:     post
title:      RSpec基本语法小结
subtitle: 笔记
date: 2020-12-10
author: Jingming
catalog: true
tags:
    - Ruby、RSpec
---
> https://xdite.gitbooks.io/rspec-101/content/contents/rspec-intro/ <br/>
 https://stackoverflow.com/questions/28006913/rspec-allow-expect-vs-just-expect-and-return <br/>
 https://www.rubyguides.com/2018/10/rspec-mocks/

### 一、Mock和Stub的区别

Mock作用是制作mock对象替换原来对象（例如未开发的复杂对象），这样原来对象的真实方法不会被调用到。

例如：Expect(mock).to receiver(:method_name).with(“params”)

作用是测试运行过程中，期待mock对象会先被传入要测的对象A中替换掉它，然后存在调用A. method_name(“params”)，其中的mock. method_name(“params”)被调用到一次。

注意的是，A中一定要有method_name的定义，且该定义要调用mock对象的method_name并传入“params”作为参数。

Stub是模拟一个可以返回值的方法，和mock一样把方法调用过程屏蔽掉，但区别是Stub注重返回，Mock注重调用过程正确。Mock出来的一定后面得调用到否则报错，而stub不一定需要。

### 二、doubles与instance_double

使用double的变种instance_double的好处是，可以配合allow (对应stub) 和 expect (对应mock)使用。

例如：

```
 expect(class_name).to receive(:method_name).with("params").and_return(result)
```
作用是根据class_name类型创建mock对象M，对mock对象对method_name方法（class里面一定有该方法）进行模拟，并期待在将来
M被调用，且一定传入了"params"，此时一定给他返回结果result。

```
 allow(class_name).to receive(:method_name).with("params").and_return(result)
```

作用是根据class_name类型创建Stub对象S，对mock对象对method_name方法（class里面不需要有该方法）进行模拟，不期待在将来
M被一定传入了"params"调用，但是只要被调用，那么返回哨兵结果result。

### 三、测试结构

- describe描述一组相关的测试，同义词context
- it 表示一个测试
